<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <title>Assign Bus to Driver</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
      .day-button {
        padding: 10px;
        margin: 5px;
        border: 1px solid #dce0e5;
        border-radius: 5px;
        cursor: pointer;
        background-color: #f0f2f4;
      }
      .day-button.selected {
        background-color: #2884e6;
        color: white;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const dayButtons = document.querySelectorAll(".day-button");
        const daysInput = document.getElementById("diasAsignados");

        dayButtons.forEach((button) => {
          button.addEventListener("click", function () {
            this.classList.toggle("selected");
            updateDaysInput();
          });
        });

        function updateDaysInput() {
          const selectedDays = [];
          dayButtons.forEach((button) => {
            if (button.classList.contains("selected")) {
              selectedDays.push(button.getAttribute("data-day"));
            }
          });
          daysInput.value = selectedDays.join(", ");
        }

        // Marcar los días seleccionados al cargar la página
        const assignedDays = daysInput.value.split(", ");
        dayButtons.forEach((button) => {
          if (assignedDays.includes(button.getAttribute("data-day"))) {
            button.classList.add("selected");
          }
        });
      });

      function updateAssignedDays(busId) {
        const dayButtons = document.querySelectorAll(`.day-button-${busId}`);
        const daysInput = document.getElementById(`diasAsignados-${busId}`);
        const selectedDays = [];

        dayButtons.forEach((button) => {
          if (button.classList.contains("selected")) {
            selectedDays.push(button.getAttribute("data-day"));
          }
        });

        daysInput.value = selectedDays.join(", ");
      }
    </script>
  </head>
  <body>
    <div
      class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
      style="font-family: Inter, 'Noto Sans', sans-serif"
    >
      <div class="layout-container flex h-full grow flex-col">
        <div class="gap-1 px-6 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col w-80">
            <div
              class="flex h-full min-h-[700px] flex-col justify-between bg-white p-4"
            >
              <div class="flex flex-col gap-4">
                <div class="flex flex-col gap-2">
                  <div class="flex items-center gap-3 px-3 py-2">
                    <p
                      class="text-[#111418] text-sm font-medium leading-normal"
                    >
                      Dashboard
                    </p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <p
                      class="text-[#111418] text-sm font-medium leading-normal"
                    >
                      Routes
                    </p>
                  </div>
                  <div
                    class="flex items-center gap-3 px-3 py-2 rounded-xl bg-[#f0f2f4]"
                  >
                    <p
                      class="text-[#111418] text-sm font-medium leading-normal"
                    >
                      Buses
                    </p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <p
                      class="text-[#111418] text-sm font-medium leading-normal"
                    >
                      Drivers
                    </p>
                  </div>
                  <div class="flex items-center gap-3 px-3 py-2">
                    <p
                      class="text-[#111418] text-sm font-medium leading-normal"
                    >
                      Reports
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            class="layout-content-container flex flex-col max-w-[960px] flex-1"
          >
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <p
                class="text-[#111418] tracking-light text-[32px] font-bold leading-tight min-w-72"
              >
                Assign Bus to Driver
              </p>
            </div>
            <form
              th:action="@{/conductores/{id}/asignar-bus(id=${conductor.id})}"
              method="post"
              class="px-4 py-3"
            >
              <div class="flex flex-col gap-4">
                <div class="flex flex-col">
                  <label
                    for="bus"
                    class="text-[#111418] text-base font-medium leading-normal pb-2"
                    >Select Bus</label
                  >
                  <select
                    id="bus"
                    name="busId"
                    class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#111418] focus:outline-0 focus:ring-0 border border-[#dce0e5] bg-white focus:border-[#dce0e5] h-14 bg-[image:--select-button-svg] placeholder:text-[#637588] p-[15px] text-base font-normal leading-normal"
                  >
                    <option value="">Select a bus</option>
                    <th:block th:each="bus : ${buses}">
                      <option
                        th:value="${bus.id}"
                        th:text="${bus.placa}"
                      ></option>
                    </th:block>
                  </select>
                </div>
                <div class="flex flex-col">
                  <label
                    for="diasAsignados"
                    class="text-[#111418] text-base font-medium leading-normal pb-2"
                    >Days Assigned</label
                  >
                  <input
                    type="hidden"
                    id="diasAsignados"
                    name="diasAsignados"
                  />
                  <div class="flex flex-wrap gap-2">
                    <div class="day-button" data-day="Monday">Monday</div>
                    <div class="day-button" data-day="Tuesday">Tuesday</div>
                    <div class="day-button" data-day="Wednesday">Wednesday</div>
                    <div class="day-button" data-day="Thursday">Thursday</div>
                    <div class="day-button" data-day="Friday">Friday</div>
                    <div class="day-button" data-day="Saturday">Saturday</div>
                    <div class="day-button" data-day="Sunday">Sunday</div>
                  </div>
                </div>
                <div class="flex justify-end">
                  <button
                    type="submit"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#2884e6] text-white text-sm font-bold leading-normal tracking-[0.015em]"
                  >
                    <span class="truncate">Assign Bus</span>
                  </button>
                </div>
              </div>
              <div
                th:if="${errorMessage}"
                class="text-red-500 text-sm font-medium"
              >
                <p th:text="${errorMessage}"></p>
              </div>
            </form>
            <div class="mt-4">
              <h3 class="text-[#111418] text-lg font-medium leading-normal">
                Assigned Buses
              </h3>
              <th:block th:each="relacion : ${busesAsignados}">
                <form
                  th:action="@{/conductores/{id}/actualizar-bus(id=${conductor.id}, busId=${relacion.busRel.id})}"
                  method="post"
                  class="border rounded p-4 mb-4"
                >
                  <p>
                    <strong>Bus:</strong>
                    <span th:text="${relacion.busRel.placa}"></span>
                  </p>
                  <p>
                    <strong>Days:</strong>
                    <span th:text="${relacion.fecha_disponible}"></span>
                  </p>
                  <input
                    type="hidden"
                    id="diasAsignados-[[${relacion.busRel.id}]]"
                    name="diasAsignados"
                    th:value="${relacion.fecha_disponible}"
                  />
                  <div class="flex flex-wrap gap-2 mt-2">
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Monday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Monday')} ? 'selected' : ''"
                    >
                      Monday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Tuesday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Tuesday')} ? 'selected' : ''"
                    >
                      Tuesday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Wednesday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Wednesday')} ? 'selected' : ''"
                    >
                      Wednesday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Thursday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Thursday')} ? 'selected' : ''"
                    >
                      Thursday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Friday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Friday')} ? 'selected' : ''"
                    >
                      Friday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Saturday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Saturday')} ? 'selected' : ''"
                    >
                      Saturday
                    </div>
                    <div
                      th:attr="onclick='updateAssignedDays(' + ${relacion.busRel.id} + ')'"
                      class="day-button day-button-[[${relacion.busRel.id}]]"
                      data-day="Sunday"
                      th:classappend="${#strings.contains(relacion.fecha_disponible, 'Sunday')} ? 'selected' : ''"
                    >
                      Sunday
                    </div>
                  </div>
                  <div class="flex justify-end mt-2">
                    <button
                      type="submit"
                      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-[#2884e6] text-white text-sm font-bold leading-normal tracking-[0.015em]"
                    >
                      <span class="truncate">Save</span>
                    </button>
                    <button
                      type="button"
                      th:attr="onclick='location.href=\'/conductores/' + ${conductor.id} + '/desasignar-bus?busId=' + ${relacion.busRel.id} + '\''"
                      class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-xl h-10 px-4 bg-red-600 text-white text-sm font-bold leading-normal tracking-[0.015em] ml-2"
                    >
                      <span class="truncate">X</span>
                    </button>
                  </div>
                </form>
              </th:block>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
